!function(t){"use strict";t.app=angular.module("workerpal",["ui.router","ngResource"]).config(["$urlRouterProvider","$stateProvider","$httpProvider",function(t,e,n){n.interceptors.push("securityInterceptor"),t.otherwise("/"),e.state("private",{url:"/private",template:"<ui-view></ui-view>",isAbstract:!0})}]).run(["$rootScope","authorization",function(t,e){t.$on("$routeChangeStart",function(t,n,o){o.authorize&&e.authorize()})}])}(window),function(t){"use strict";t.app.controller("LoginPanelController",["$scope","$state","user","authentication",function(t,e,n,o){t.user=n,t.logout=function(){o.logout(),e.go("home")}}])}(window),function(t){"use strict";t.app.config(["$stateProvider",function(t){t.state("home",{url:"/",templateUrl:"app/home/view.html",controller:"HomeController"})}]).controller("HomeController",["$scope",function(t){}])}(window),function(t){"use strict";t.app.config(["$stateProvider",function(t){t.state("login",{url:"/login",templateUrl:"app/login/view.html",controller:"LoginController"})}]).controller("LoginController",["$scope","$state","authentication",function(t,e,n){t.doLogin=function(){n.login(t.login.username,t.login.password).then(function(){e.go("private.home")},function(){t.loginErrorMessage="Invalid username or password. Please, try again."})}}])}(window),function(t){"use strict";t.app.service("authentication",["$http","$q","$window","user",function(t,e,n,o){function r(t){o.id=t.user.id,o.userName=t.user.userName,o.name=t.user.name,o.authType=t.authType,o.isAuthenticated=!0,n.sessionStorage.token=t.token}function i(){o.id="",o.userName="",o.name="",o.authType="",o.isAuthenticated=!1,delete n.sessionStorage.token}return{login:function(n,o){var i=e.defer();return t.post("api/login",{username:n,password:o}).then(function(t){var e=t.data;r(e),i.resolve()},function(t){i.reject()}),i.promise},loginFb:function(n){var o=e.defer();return t.post("api/loginFb",{email:n}).then(function(t){var e=t.data;r(e),o.resolve()},function(t){o.reject()}),o.promise},logout:function(){t.post("api/logout").then(function(t){i()},function(t){})}}}])}(window),function(t){"use strict";t.app.service("authorization",["$q","$state","$timeout","$window","$log",function(t,e,n,o,r){return{authorize:function(){var i=t.defer();return n(function(){o.sessionStorage.token?(r.info("Authorized"),i.resolve()):(i.reject(),r.info("Unauthorized"),e.go("login"))},10),i.promise}}}])}(window),function(t){"use strict";t.app.service("config",[function(){return{fbAppId:"1577181932557797"}}])}(window),function(t){"use strict";t.app.run(["$rootScope","$window","facebookService","config",function(t,e,n,o){e.fbAsyncInit=function(){FB.init({appId:o.fbAppId,channelUrl:"public/app/channel.html",status:!0,cookie:!0,xfbml:!0}),n.watchAuthenticationStatusChange()}}])}(window),function(t){var e,n="facebook-jssdk",o=t.getElementsByTagName("script")[0];t.getElementById(n)||(e=t.createElement("script"),e.id=n,e.async=!0,e.src="//connect.facebook.net/en_US/all.js",o.parentNode.insertBefore(e,o))}(document),function(t){"use strict";t.app.service("facebookService",["$rootScope","$q","$state","authentication",function(t,e,n,o){function r(){var t=e.defer();return FB.api("/me",function(e){t.resolve(e)}),t.promise}function i(){o.logout(),n.go("home")}return{watchAuthenticationStatusChange:function(){FB.Event.subscribe("auth.authResponseChange",function(e){"connected"===e.status?r().then(function(e){o.loginFb(e.email).then(function(){t.fbLoginError=!1,n.go("private.home")},function(){t.fbLoginError=!0})},function(){}):i()})},logout:function(){var t=e.defer();return FB.logout(function(e){t.resolve(res)}),t.promise}}}])}(window),function(t){"use strict";t.app.service("projectsService",["$http","$q","user",function(t,e,n){return{list:function(){var n=e.defer();return t.get("api/projects").then(function(t){n.resolve(t.data)},function(t){n.reject()}),n.promise}}}])}(window),function(t){"use strict";t.app.factory("securityInterceptor",["$q","$window","$location","user",function(t,e,n,o){return{request:function(t){return t.headers=t.headers||{},e.sessionStorage.token&&(t.headers.Authorization="Bearer "+e.sessionStorage.token),t},requestError:function(e){return t.reject(e)},response:function(n){return null!=n&&200==n.status&&e.sessionStorage.token&&!o.isAuthenticated&&(o.isAuthenticated=!0),n||t.when(n)},responseError:function(r){return null!=r&&401===r.status&&(e.sessionStorage.token||o.isAuthenticated)&&(delete e.sessionStorage.token,o.isAuthenticated=!1,n.url("/login")),t.reject(r)}}}])}(window),function(t){"use strict";t.app.provider("authState",["$stateProvider",function(t){var e=this;return this.$get=function(){return e},this.state=function(e,n){n.resolve=n.resolve||{},n.resolve.authorized=["authorization",function(t){return t.authorize()}],t.state(e,n)},e}])}(window),function(t){"use strict";t.app.service("user",[function(){return{id:"",userName:"",Name:"",isAuthenticated:!1}}])}(window),function(t){"use strict";t.app.config(["authStateProvider",function(t){t.state("private.home",{url:"/",templateUrl:"app/private/home/view.html",controller:"PrivateHomeController",resolve:{projects:["projectsService",function(t){return t.list()}]}})}]).controller("PrivateHomeController",["$scope","projects","authorized",function(t,e,n){t.projects=e}])}(window);
//# sourceMappingURL=app-all.min.js.map
