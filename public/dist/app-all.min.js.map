{"version":3,"sources":["app.js","login-ctrl.js","home/ctrl.js","login/ctrl.js","services/authentication.js","services/authorization.js","services/config.js","services/facebook-init.js","services/facebook-service.js","services/projects-service.js","services/security-interceptor.js","services/state-provider-decorator.js","services/user.js","private/home/ctrl.js"],"names":["window","app","angular","module","config","$urlRouterProvider","$stateProvider","$httpProvider","interceptors","push","otherwise","state","url","template","isAbstract","run","$rootScope","authorization","$on","e","curr","prev","authorize","controller","$scope","$state","user","authentication","logout","go","templateUrl","doLogin","login","username","password","then","loginErrorMessage","service","$http","$q","$window","setLoggedInfo","authInfo","id","userName","name","authType","isAuthenticated","sessionStorage","token","cleanLoggedInfo","deferred","defer","post","data","resolve","response","reject","promise","loginFb","email","$timeout","$log","info","fbAppId","facebookService","fbAsyncInit","FB","init","appId","channelUrl","status","cookie","xfbml","watchAuthenticationStatusChange","d","js","ref","getElementsByTagName","getElementById","createElement","async","src","parentNode","insertBefore","document","getUserInfo","api","res","appLogout","Event","subscribe","fbLoginError","list","get","factory","$location","request","headers","Authorization","requestError","rejection","when","responseError","provider","this","$get","options","authorized","Name","authState","projects","projectsService"],"mappings":"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","file":"public/dist/app-all.min.js","sourcesContent":["(function (window) {\n    'use strict';\n    \n    window.app = angular.module('workerpal',\n        ['ui.router', 'ngResource'])\n    .config(['$urlRouterProvider', '$stateProvider', '$httpProvider', \n        function ($urlRouterProvider, $stateProvider, $httpProvider) {\n            \n            $httpProvider.interceptors.push('securityInterceptor');\n            \n            $urlRouterProvider.otherwise('/');\n            \n            $stateProvider.state('private', {\n                url: '/private',\n                template: '<ui-view></ui-view>',\n                isAbstract: true\n            });\n        }])\n    .run(['$rootScope', 'authorization', function ($rootScope, authorization) {\n            \n            $rootScope.$on('$routeChangeStart', function (e, curr, prev) {\n                if (prev.authorize) {\n                    authorization.authorize();\n                }\n            });\n        }]);\n}(window));\n\n","/**\n * Created by Alex on 9/26/2015.\n */\n(function(window){\n    'use strict';\n\n    window.app.controller('LoginPanelController', ['$scope','$state', 'user', 'authentication',\n        function($scope, $state, user, authentication){\n            $scope.user = user;\n\n            $scope.logout = function(){\n                authentication.logout();\n                $state.go('home');\n            };\n    }]);\n\n})(window);","(function(window){\n    'use strict';\n\n    window.app.config(['$stateProvider', function($stateProvider){\n        $stateProvider.state('home', {\n            url: '/',\n            templateUrl: 'app/home/view.html',\n            controller: 'HomeController'\n        });\n    }])\n    .controller('HomeController', ['$scope', function($scope){\n\n    }]);\n})(window);\n","/**\n * Created by Alex on 9/23/2015.\n */\n(function(window){\n    'use strict';\n\n    window.app.config(['$stateProvider', function($stateProvider) {\n        $stateProvider.state('login', {\n            url: '/login',\n            templateUrl: 'app/login/view.html',\n            controller: 'LoginController'\n        });\n    }])\n    .controller('LoginController', ['$scope', '$state', 'authentication', function($scope, $state, authentication){\n        $scope.doLogin = function() {\n            authentication.login($scope.login.username, $scope.login.password)\n                .then(function(){\n                    $state.go('private.home');\n                }, function(){\n                    $scope.loginErrorMessage = \"Invalid username or password. Please, try again.\";\n                });\n        };\n    }]);\n})(window);\n","(function (window) {\n    'use strict';\n    \n    window.app.service('authentication', ['$http', '$q', '$window', 'user',\n        function ($http, $q, $window, user) {\n            \n            function setLoggedInfo(authInfo) {\n                user.id = authInfo.user.id;\n                user.userName = authInfo.user.userName;\n                user.name = authInfo.user.name;\n                user.authType = authInfo.authType;\n                user.isAuthenticated = true;\n                $window.sessionStorage.token = authInfo.token;\n            }\n            \n            function cleanLoggedInfo(){\n                user.id = '';\n                user.userName = '';\n                user.name = '';\n                user.authType = '';\n                user.isAuthenticated = false;\n                delete $window.sessionStorage.token;\n            }\n\n            return {\n                login: function (username, password) {\n                    var deferred = $q.defer();\n                    \n                    $http.post('api/login', {\n                        username: username,\n                        password: password\n                    })\n                    .then(function (data) {\n                        var authInfo = data.data;\n                        setLoggedInfo(authInfo);\n                        deferred.resolve();\n                    }, function (response) {\n                        deferred.reject();\n                    });\n                    \n                    return deferred.promise;\n                },\n                loginFb: function (email) {\n                    var deferred = $q.defer();\n                    \n                    $http.post('api/loginFb', {\n                        email: email\n                    })\n                    .then(function (data) {\n                        var authInfo = data.data;\n                        setLoggedInfo(authInfo);\n                        deferred.resolve();\n                    }, function (response) {\n                        deferred.reject();\n                    });\n                    \n                    return deferred.promise;\n                },\n                logout: function () {\n                    var that = this;\n                    \n                    $http.post('api/logout').then(function (response) {\n                        cleanLoggedInfo();\n                    }, function (response) {\n                    });\n                }\n            };\n        }\n    ]);\n    \n})(window);","/**\n * Created by Alex on 9/26/2015.\n */\n(function(window){\n    'use strict';\n\n    window.app.service('authorization', ['$q', '$state', '$timeout', '$window', '$log',\n        function($q, $state, $timeout, $window, $log) {\n            return {\n                authorize: function(){\n                    // Initialize a new promise\n                    var deferred = $q.defer();\n\n                    $timeout(function(){\n                        if ($window.sessionStorage.token) {\n                            $log.info('Authorized');\n                            deferred.resolve();\n                        }\n                        else {\n                            deferred.reject();\n                            $log.info('Unauthorized');\n                            $state.go('login');\n                        }\n                    }, 10);\n\n                    return deferred.promise;\n                }\n            };\n        }\n    ]);\n\n})(window);","(function (window) {\n    'use strict';\n    \n    window.app.service('config', [\n        function () {\n            return {\n                fbAppId: '1577181932557797'\n            };\n        }\n    ]);\n})(window);","(function (window) {\n    'use strict';\n    \n    window.app.run(['$rootScope', '$window', 'facebookService', 'config', \n        function ($rootScope, $window, facebookService, config) {\n            \n            $window.fbAsyncInit = function () {\n                // Executed when the SDK is loaded\n                \n                FB.init({\n                    appId: config.fbAppId, \n                    //Adding a Channel File improves the performance \n                    //of the javascript SDK, by addressing issues \n                    //with cross-domain communication in certain browsers. \n                    channelUrl: 'public/app/channel.html', \n                    //Set if you want to check the authentication status\n                    //at the start up of the app \n                    status: true, \n                    //Enable cookies to allow the server to access \n                    //the session \n                    cookie: true, \n                    //Parse XFBML\n                    xfbml: true\n                });\n                \n                facebookService.watchAuthenticationStatusChange();\n            };\n        }]);\n\n})(window);\n\n(function (d) {\n    // load the Facebook javascript SDK\n    \n    var js, \n        id = 'facebook-jssdk', \n        ref = d.getElementsByTagName('script')[0];\n    \n    if (d.getElementById(id)) {\n        return;\n    }\n    \n    js = d.createElement('script');\n    js.id = id;\n    js.async = true;\n    js.src = \"//connect.facebook.net/en_US/all.js\";\n    \n    ref.parentNode.insertBefore(js, ref);\n\n}(document));","(function (window) {\n    'use strict';\n    \n    window.app.service('facebookService', ['$rootScope', '$q', '$state', 'authentication',\n        function ($rootScope, $q, $state, authentication) {\n            \n            function getUserInfo() {\n                var deferred = $q.defer();\n                \n                FB.api('/me', function (res) {\n                    deferred.resolve(res);\n                    //TODO: handle failure and reject promise\n                });\n                \n                return deferred.promise;\n            }\n            \n            function appLogout() {\n                authentication.logout();\n                $state.go('home');\n            }\n            \n            return {\n                watchAuthenticationStatusChange: function () {\n                    var _this = this;\n                    \n                    FB.Event.subscribe('auth.authResponseChange', function (res) {\n                        if (res.status === 'connected') {\n                            getUserInfo().then(function (user) {\n                                authentication.loginFb(user.email).then(function () {\n                                    $rootScope.fbLoginError = false;\n                                    $state.go('private.home');\n                                }, function () {\n                                    $rootScope.fbLoginError = true;\n                                });\n                            }, function () {\n                                \n                            });\n                        } \n                        else {\n                            appLogout();\n                        }\n                    });\n                },\n                \n                logout: function () {\n                    var deferred = $q.defer();\n                    FB.logout(function (response) {\n                        deferred.resolve(res);\n                        //TODO: handle failure and reject promise\n                    });\n                    return deferred.promise;\n                }\n            };\n        }\n    ]);\n})(window);","(function (window) {\n    'use strict';\n    \n    window.app.service('projectsService', ['$http', '$q', 'user',\n        function ($http, $q, user) {\n            return {\n                list: function () {\n                    var deferred = $q.defer();\n                    \n                    $http.get('api/projects').then(function (response) {\n                        deferred.resolve(response.data);\n                    }, function (response) {\n                        deferred.reject();\n                    });\n                    \n                    return deferred.promise;\n                }\n            };\n        }\n    ]);\n    \n})(window);","/**\n * Created by Alex on 9/26/2015.\n */\n(function(window){\n    'use strict';\n\n    window.app.factory('securityInterceptor', ['$q', '$window', '$location', 'user',\n        function($q, $window, $location, user) {\n            return {\n                request: function (config) {\n                    config.headers = config.headers || {};\n                    if ($window.sessionStorage.token) {\n                        config.headers.Authorization = 'Bearer ' + $window.sessionStorage.token;\n                    }\n                    return config;\n                },\n\n                requestError: function(rejection) {\n                    return $q.reject(rejection);\n                },\n\n                /* Set Authentication.isAuthenticated to true if 200 received */\n                response: function (response) {\n                    if (response != null\n                            && response.status == 200\n                            && $window.sessionStorage.token\n                            && !user.isAuthenticated) {\n                        user.isAuthenticated = true;\n                    }\n                    return response || $q.when(response);\n                },\n\n                /* Revoke client authentication if 401 is received */\n                responseError: function(rejection) {\n                    if (rejection != null\n                            && rejection.status === 401\n                            && ($window.sessionStorage.token || user.isAuthenticated)) {\n                        delete $window.sessionStorage.token;\n                        user.isAuthenticated = false;\n                        $location.url(\"/login\");\n                    }\n\n                    return $q.reject(rejection);\n                }\n            };\n        }\n    ]);\n\n})(window);","(function (window) {\n    'use strict';\n    \n    window.app.provider('authState', ['$stateProvider',  \n        function ($stateProvider) {\n            var provider = this;\n            \n            this.$get = function () {\n                return provider;\n            };\n            \n            this.state = function (name, options) {\n                options.resolve = options.resolve || {};\n                options.resolve.authorized = ['authorization', function (authorization) {\n                        return authorization.authorize();\n                    }];\n                \n                $stateProvider.state(name, options);\n            };\n            \n            return provider;\n        }]);\n})(window);","(function(window){\n    'use strict';\n\n    window.app.service('user', [\n        function() {\n            return {\n                id: '',\n                userName: '',\n                Name: '',\n                isAuthenticated: false\n            };\n        }\n    ]);\n\n})(window);","(function (window) {\n    'use strict';\n    \n    window.app.config(['authStateProvider', function (authState) {\n            authState.state('private.home', {\n                url: '/',\n                templateUrl: 'app/private/home/view.html',\n                controller: 'PrivateHomeController',\n                resolve: {\n                    projects: ['projectsService', function (projectsService) {\n                            return projectsService.list();\n                        }]\n                }\n            });\n        }])\n    .controller('PrivateHomeController', ['$scope', 'projects', 'authorized', function ($scope, projects, authorized) {\n            $scope.projects = projects;\n        }]);\n})(window);\n"],"sourceRoot":"/source/"}